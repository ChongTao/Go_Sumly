Cobra 提供了一种简单而强大的方式来构建命令行客户端，它能够帮助开发者快速实现复杂的命令行工具，并且提供了丰富的功能和选项，包括自动生成帮助文档、自动补全等。

Cobra 是基于命令（`commands`）、参数（`arguments` ）、选项（`flags`）而创建的。

- **commands**：命令代表行为,一般表示 action，即运行的二进制命令服务。同时可以拥有子命令（children commands）

- **arguments**：参数代表命令行参数。

- **flags**：选项代表对命令行为的改变，即命令行选项。二进制命令的配置参数，可对应配置文件。参数可分为全局参数和子命令参数。

## 1 使用

1. Cobra安装

   使用go get命令下载Cobra库

   ```go
   go get -u github.com/spf13/cobra/cobra
   ```

2. 工程初始化

   Cobra提供代码生成器功能，使用Cobra提供的初始化命令cobra init创建Cobra命令。

   ```sh
   cobra init --pkg-name
   ```

   初始化后结构如下：

   ```html
   ├── cmd
   │   ├── root.go
   │   └── show.go
   ├── go.mod
   ├── go.sum
   └── main.go
   ```

3. 运行

   ```cmd
   go run
   ```

4. 示例

   ```go
   var showCmd = &cobra.Command{
   	Use:   "show",        // 用于指定具体的命令
   	Short: "A brief description of your command",  // 简述描述
   	Long: `A longer description that spans multiple lines and likely contains examples
   and usage of using your command. For example:
   Cobra is a CLI library for Go that empowers applications.
   This application is a tool to generate the needed files
   to quickly create a Cobra application.`,    // 详细描述
       Run: func(cmd *cobra.Command, args []string) {         // 命令执行入口，用于实现命令的具体处理逻辑
           fmt.Println("show called")
       },
   }
   
   func init() {
       rootCmd.AddCommand(showCmd)   // 命令添加，将命令添加到根命令中
       // Here you will define your flags and configuration settings.
       // Cobra supports Persistent Flags which will work for this command
       // and all subcommands, e.g.:
       // showCmd.PersistentFlags().String("foo", "", "A help for foo")
       // Cobra supports local flags which will only run when this command
       // is called directly, e.g.:
       // showCmd.Flags().BoolP("toggle", "t", false, "Help message for toggle")
   }
   
   
   func init() {
   	rootCmd.PersistentFlags().String("version", "", "版本")
   }
    
   func Execute() {
   	cobra.CheckErr(rootCmd.Execute())
   }
   ```
   

## 2 核心

Cobra的核心是`cobra.Command`:

```go
var rootCmd = &cobra.Command{
    Use:   "myapp",
    Short: "这是一个示例 CLI 工具",
    Long:  "这是一个使用 Cobra 构建的示例命令行程序",
    Run: func(cmd *cobra.Command, args []string) {
        fmt.Println("Hello Cobra!")
    },
}
```

- Use：定义命令名称以及参数格式。
- Short：简短说明命令。
- Long：详细介绍该命令。
- Args：参数检验函数，校验非flag参数。
- Run/RunE：命令执行逻辑，一个不返回错误，一个返回错误。

常用的方法：

- AddCommand：子命令管理，可将子命令挂到当前命令下。

- Flags：

  ```go
  cmd.Flags()            // 仅当前命令
  cmd.PersistentFlags()  // 当前 + 子命令
  cmd.LocalFlags()       // 本地 flags
  
  // 定义Flags
  cmd.Flags().StringP("name", "n", "", "用户名")
  
  // 读取Flags
  cmd.Flags().GetString("name")
  
  ```

- Execute：CLI程序入口，一般只在main.go中调用一次。

  ```go
  rootCmd.Execute()
  ```

- cobra.OnInitialize：在执行命令前调用，一般用户加载配置（Viper）

  ```go
  cobra.OnInitialize(funcs ...func())
  ```

  
